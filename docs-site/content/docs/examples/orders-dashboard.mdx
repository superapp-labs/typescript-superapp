---
title: Orders Dashboard
icon: ShoppingCart
description: Full page example with data table and queries.
---

A complete Next.js page that displays an orders table with loading states, authentication, and typed queries.

```tsx
'use client'

import { useEffect, useState } from 'react'
import { useSession } from '@superapp/db/auth'
import { useDb } from '@/hooks/use-db'
import { ne, desc } from 'drizzle-orm'
import * as schema from '@/generated/schema'

interface Order {
  id: number
  amount: number
  status: string
  customer: { name: string; email: string }
  created_at: string
}

export default function OrdersDashboard() {
  const { data: session, isPending } = useSession()
  const db = useDb()
  const [orders, setOrders] = useState<Order[]>([])
  const [loading, setLoading] = useState(true)

  useEffect(() => {
    if (!db) return
    setLoading(true)
    db.query.orders.findMany({
      with: { customer: true },
      where: ne(schema.orders.status, 'cancelled'),
      orderBy: desc(schema.orders.createdAt),
      limit: 50,
    })
      .then(setOrders)
      .finally(() => setLoading(false))
  }, [db])

  if (isPending) return <p>Loading session...</p>
  if (!session) return <p>Please sign in to view orders.</p>
  if (loading) return <p>Loading orders...</p>

  return (
    <div>
      <h1>Orders</h1>
      <table>
        <thead>
          <tr>
            <th>ID</th>
            <th>Customer</th>
            <th>Amount</th>
            <th>Status</th>
            <th>Date</th>
          </tr>
        </thead>
        <tbody>
          {orders.map((order) => (
            <tr key={order.id}>
              <td>{order.id}</td>
              <td>{order.customer.name}</td>
              <td>${order.amount.toFixed(2)}</td>
              <td>{order.status}</td>
              <td>{new Date(order.created_at).toLocaleDateString()}</td>
            </tr>
          ))}
        </tbody>
      </table>
    </div>
  )
}
```

## What This Uses

- **`useSession`** -- checks if the user is authenticated and provides loading state
- **`useDb`** -- returns a typed database client bound to the user's session token
- **`db.query.orders.findMany`** -- queries `main.orders` with a relation join on `customer`, a filter, sort, and limit

## Required Backend Permissions

The backend must grant the user's role access to both `orders` and `customers`:

```typescript
const engine = createEngine({
  permissions: {
    read_orders: {
      name: 'Read orders',
      table: 'main.orders',
      operations: { select: true },
      columns: ['id', 'amount', 'status', 'customer_id', 'created_at'],
    },
    read_customers: {
      name: 'Read customers',
      table: 'main.customers',
      operations: { select: true },
      columns: ['id', 'name', 'email'],
    },
  },
  roles: {
    viewer: ['read_orders', 'read_customers'],
  },
})
```

## The useDb Hook

This hook is generated by `create-app` and connects the client SDK to the user's session:

```typescript
// hooks/use-db.ts
import { useMemo } from 'react'
import { useSession } from '@superapp/db/auth'
import { createDb } from '@/lib/db'

export function useDb() {
  const { data: session } = useSession()
  return useMemo(
    () => (session?.token ? createDb(session.token) : null),
    [session?.token],
  )
}
```

## Adding Pagination

Extend the example with offset-based pagination:

```tsx
const [page, setPage] = useState(0)
const pageSize = 20

useEffect(() => {
  if (!db) return
  setLoading(true)
  db.query.orders.findMany({
    with: { customer: true },
    where: ne(schema.orders.status, 'cancelled'),
    orderBy: desc(schema.orders.createdAt),
    limit: pageSize,
    offset: page * pageSize,
  })
    .then(setOrders)
    .finally(() => setLoading(false))
}, [db, page])
```

```tsx
<div>
  <button onClick={() => setPage((p) => Math.max(0, p - 1))}>Previous</button>
  <span>Page {page + 1}</span>
  <button onClick={() => setPage((p) => p + 1)}>Next</button>
</div>
```
